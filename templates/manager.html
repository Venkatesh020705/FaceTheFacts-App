{% extends "layout.html" %}
{% block content %}

<!-- Manager Header -->
<div class="row mb-4">
    <div class="col-md-8">
        <h2 class="fw-bold text-dark"><i class="bi bi-buildings-fill text-primary"></i> Corporate Wellness Hub</h2>
        <p class="text-muted">Real-time insights into organizational health and productivity.</p>
    </div>
    <div class="col-md-4 text-end">
        <button class="btn btn-outline-danger" onclick="alert('Simulated: Notifications sent to 3 at-risk employees.')">
            <i class="bi bi-exclamation-triangle-fill"></i> Alert Risk Group
        </button>
        <button class="btn btn-primary ms-2">
            <i class="bi bi-download"></i> Export Report
        </button>
    </div>
</div>

<!-- KEY METRICS -->
<div class="row mb-4">
    <!-- Team Health Score -->
    <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100 bg-primary text-white" style="background: linear-gradient(45deg, #2c3e50, #3498db);">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase opacity-75 mb-1">Overall Team Health</h6>
                        <h1 class="display-4 fw-bold mb-0">{{ health_score }}%</h1>
                        <span class="badge bg-white text-success mt-2">
                            <i class="bi bi-arrow-up-short"></i> +4% vs Last Week
                        </span>
                    </div>
                    <div class="display-1 opacity-25">
                        <i class="bi bi-heart-pulse-fill"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Burnout Risk -->
    <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="text-uppercase text-muted mb-0">Burnout Radar</h6>
                    <span class="badge bg-danger rounded-pill">{{ risk_count }} Risks</span>
                </div>
                <div class="alert alert-danger bg-danger bg-opacity-10 border-0 small mb-0">
                    <strong>Attention Needed:</strong> 3 employees are showing signs of chronic digital eye strain and low blink rates.
                </div>
                <div class="mt-3 text-center">
                    <div class="progress" style="height: 6px;">
                        <div class="progress-bar bg-danger" style="width: 25%"></div>
                    </div>
                    <small class="text-muted">Risk Threshold</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Live Active -->
    <div class="col-md-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase text-muted mb-1">Active Now</h6>
                        <h2 class="fw-bold mb-0">{{ active }}</h2>
                        <p class="text-success small mb-0">‚óè Online & Monitoring</p>
                    </div>
                    <div class="fs-1 text-muted opacity-25">
                        <i class="bi bi-people-fill"></i>
                    </div>
                </div>
                <hr>
                <div class="d-flex justify-content-between small text-muted">
                    <span>Engineering: 12</span>
                    <span>Design: 8</span>
                    <span>Sales: 22</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- CHARTS & LISTS -->
<div class="row">
    <!-- Left: Hourly Trend (The "Toxic Hour" Analysis) -->
    <div class="col-lg-8 mb-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white py-3">
                <h5 class="mb-0 fw-bold">üìâ Average Stress by Hour</h5>
            </div>
            <div class="card-body">
                <canvas id="teamChart" height="120"></canvas>
                <p class="small text-muted mt-3 text-center">
                    <i class="bi bi-info-circle"></i> 
                    Spike at <b>1 PM</b> suggests "Post-Lunch Slump" or "Meeting Fatigue".
                </p>
            </div>
        </div>
    </div>

    <!-- Right: Employee Pulse -->
    <div class="col-lg-4 mb-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-white py-3 d-flex justify-content-between">
                <h5 class="mb-0 fw-bold">Live Pulse</h5>
                <small class="text-muted">Updated 1m ago</small>
            </div>
            <div class="card-body p-0">
                <div class="list-group list-group-flush">
                    {% for emp in employees %}
                    <div class="list-group-item d-flex justify-content-between align-items-center px-4 py-3">
                        <div class="d-flex align-items-center">
                            <div class="bg-light rounded-circle d-flex justify-content-center align-items-center me-3" 
                                 style="width: 40px; height: 40px; fw-bold">
                                {{ emp.name[0] }}
                            </div>
                            <div>
                                <div class="fw-bold text-dark">{{ emp.name }}</div>
                                <small class="text-muted">{{ emp.role }}</small>
                            </div>
                        </div>
                        <div class="text-end">
                            {% if emp.stress > 60 %}
                                <span class="badge bg-danger bg-opacity-10 text-danger">High Stress</span>
                            {% elif emp.stress > 30 %}
                                <span class="badge bg-warning bg-opacity-10 text-warning">Fatigued</span>
                            {% else %}
                                <span class="badge bg-success bg-opacity-10 text-success">Flow State</span>
                            {% endif %}
                            <div class="small text-muted mt-1">Blinks: {{ emp.blinks }}/m</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div class="card-footer bg-white text-center">
                <a href="#" class="text-decoration-none small fw-bold">View All 42 Employees</a>
            </div>
        </div>
    </div>
</div>

<!-- Chart Logic -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('teamChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ hours | tojson }},
            datasets: [{
                label: 'Avg Stress Level (0-100)',
                data: {{ hourly_stress | tojson }},
                borderColor: '#e74c3c',
                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true, max: 100 }
            }
        }
    });
</script>

{% endblock %}